<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>UP Diliman Jeepneys</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.js"></script>
<style>
body { margin: 0; padding: 0; }
.map-overlay {position: absolute;bottom: 0;right: 0;background: #fff;opacity:0.7;margin-right: 60px;font-family: Arial, sans-serif;overflow: auto;border-radius: 2px;}
#map { position: absolute; top: 0; bottom: 0; width: 100%; }
#legend {padding: 5px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); line-height: 18px;height: 75px;margin-bottom: 30px;width: 100px;margin-right: 10px}
.legend-key {display: inline-block;border-radius: 20%;width: 20px;height: 20px;margin-right: 5px;}
</style>
</head>

<body>
<div id="map"></div>
<div class='map-overlay' id='legend'></div>
<script>
	mapboxgl.accessToken = 'pk.eyJ1IjoidXByaS1ub2FoIiwiYSI6ImNrcmExaDdydzRldWYyb21udmw1ejY3ZDYifQ.cs3Ahz2S6fERoI1BAwFO9g';
    const map = new mapboxgl.Map({
        container: 'map', // container ID
        // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
        style: 'mapbox://styles/mapbox/dark-v11', // style URL
        center: [121.06857,14.65501], // starting position [lng, lat]
        zoom: 15 // starting zoom
    });

    const geojson = {
        'type': 'FeatureCollection',
        'features': [
            {
                'type': 'Feature',
                "properties": { "type": 'ikot' },
                "geometry": { 
                    "type": "MultiLineString", 
                    "coordinates": [ [ [ 121.065268474469519, 14.647767062292608 ], [ 121.065746999650074, 14.647951775732121 ], [ 121.066227149766263, 14.647972207651957 ], [ 121.067218097878367, 14.647532921375454 ], [ 121.067841271433409, 14.647277522377488 ], [ 121.06800277434462, 14.647212450213077 ], [ 121.069005890864133, 14.647206010658056 ], [ 121.068985458944297, 14.648207174730087 ], [ 121.068954811064543, 14.64896315576407 ], [ 121.068842435505445, 14.649259418601712 ], [ 121.068668764186825, 14.649749784677809 ], [ 121.068403149228956, 14.650679437030409 ], [ 121.068474660948397, 14.651476281904067 ], [ 121.068576820547577, 14.652007511819837 ], [ 121.068658548226935, 14.652497877895934 ], [ 121.071697409056782, 14.652538602102824 ], [ 121.071663779214973, 14.653928635563991 ], [ 121.072779168968097, 14.653939845511259 ], [ 121.073153570591145, 14.654633013518938 ], [ 121.073112706751473, 14.655521802031863 ], [ 121.073112706751473, 14.655746553150074 ], [ 121.072744932194396, 14.656175623466659 ], [ 121.072755148154314, 14.657554778055681 ], [ 121.072690583264219, 14.659459646101801 ], [ 121.069565797089297, 14.659448610953447 ], [ 121.068563437780696, 14.659421023082569 ], [ 121.068565534509091, 14.657551190068096 ], [ 121.064783879225246, 14.657586086925011 ], [ 121.063669821747936, 14.657680766030733 ], [ 121.062350626208229, 14.657693389911495 ], [ 121.062351039251567, 14.65677259114206 ], [ 121.062329065988678, 14.654991948904904 ], [ 121.0623323150473, 14.653864262535059 ], [ 121.062319885629407, 14.652149002864713 ], [ 121.0623323150473, 14.650607755044982 ], [ 121.062344744465207, 14.648519612837603 ], [ 121.062307456211499, 14.647525259405519 ], [ 121.062319885629378, 14.647351247554905 ], [ 121.063470033355273, 14.64761943640722 ], [ 121.063946193088469, 14.647703156799871 ], [ 121.064213051840042, 14.647703156799871 ], [ 121.064651537396543, 14.647701063790052 ], [ 121.064897466049942, 14.647711528839132 ], [ 121.065117232080652, 14.647742923986376 ], [ 121.065258510243254, 14.647763854084539 ], [ 121.065258510243254, 14.647763854084539 ], [ 121.065268443105239, 14.647767062292608 ] ] ] 
                }
            }
        ]
    };

    const geojson_2 = {
        'type': 'FeatureCollection',
        'features': [
            {
                'type': 'Feature',
                "properties": { "type": 'ikot' },
                "geometry": { 
                    "type": "MultiLineString", 
                    "coordinates": [ [ [ 121.065268474469519, 14.647767062292608 ], [ 121.065746999650074, 14.647951775732121 ], [ 121.066227149766263, 14.647972207651957 ], [ 121.067218097878367, 14.647532921375454 ], [ 121.067841271433409, 14.647277522377488 ], [ 121.06800277434462, 14.647212450213077 ], [ 121.069005890864133, 14.647206010658056 ], [ 121.068985458944297, 14.648207174730087 ], [ 121.068954811064543, 14.64896315576407 ], [ 121.068842435505445, 14.649259418601712 ], [ 121.068668764186825, 14.649749784677809 ], [ 121.068403149228956, 14.650679437030409 ], [ 121.068474660948397, 14.651476281904067 ], [ 121.068576820547577, 14.652007511819837 ], [ 121.068658548226935, 14.652497877895934 ], [ 121.071697409056782, 14.652538602102824 ], [ 121.071663779214973, 14.653928635563991 ], [ 121.072779168968097, 14.653939845511259 ], [ 121.073153570591145, 14.654633013518938 ], [ 121.073112706751473, 14.655521802031863 ], [ 121.073112706751473, 14.655746553150074 ], [ 121.072744932194396, 14.656175623466659 ], [ 121.072755148154314, 14.657554778055681 ], [ 121.072690583264219, 14.659459646101801 ], [ 121.069565797089297, 14.659448610953447 ], [ 121.068563437780696, 14.659421023082569 ], [ 121.068565534509091, 14.657551190068096 ], [ 121.064783879225246, 14.657586086925011 ], [ 121.063669821747936, 14.657680766030733 ], [ 121.062350626208229, 14.657693389911495 ], [ 121.062351039251567, 14.65677259114206 ], [ 121.062329065988678, 14.654991948904904 ], [ 121.0623323150473, 14.653864262535059 ], [ 121.062319885629407, 14.652149002864713 ], [ 121.0623323150473, 14.650607755044982 ], [ 121.062344744465207, 14.648519612837603 ], [ 121.062307456211499, 14.647525259405519 ], [ 121.062319885629378, 14.647351247554905 ], [ 121.063470033355273, 14.64761943640722 ], [ 121.063946193088469, 14.647703156799871 ], [ 121.064213051840042, 14.647703156799871 ], [ 121.064651537396543, 14.647701063790052 ], [ 121.064897466049942, 14.647711528839132 ], [ 121.065117232080652, 14.647742923986376 ], [ 121.065258510243254, 14.647763854084539 ], [ 121.065258510243254, 14.647763854084539 ], [ 121.065268443105239, 14.647767062292608 ] ] ] 
                }
            },
            {
                'type': 'Feature',
                "properties": { "type": 'katip' },
                "geometry": { 
                    "type": "MultiLineString", 
                    "coordinates": [ [ [ 121.074511647380348, 14.647709363893577 ], [ 121.07450207046719, 14.651051706586989 ], [ 121.074482916640861, 14.652344589863809 ], [ 121.074480777796921, 14.653501768281123 ], [ 121.074573993085025, 14.654398965429147 ], [ 121.074550689263006, 14.655412681687304 ], [ 121.074550689263006, 14.656764303364847 ], [ 121.074487407294811, 14.657584028095716 ], [ 121.074235521359597, 14.657568285224766 ], [ 121.073930415921282, 14.657571903833404 ], [ 121.073165412600787, 14.657564720703634 ], [ 121.072731177646347, 14.657550354444094 ], [ 121.072733637622292, 14.65792181081234 ], [ 121.072720001451728, 14.658560651225518 ], [ 121.072707074312277, 14.659448314800658 ], [ 121.072077953526019, 14.659435387661215 ], [ 121.071754775039906, 14.659439696707697 ], [ 121.070492224420889, 14.659426769568253 ], [ 121.068543706717904, 14.659423609401339 ], [ 121.068564968670401, 14.657547242093329 ], [ 121.066562836913363, 14.657569779762975 ], [ 121.06479341722644, 14.657577540375636 ], [ 121.063931083816144, 14.657677522935433 ], [ 121.062363698745514, 14.657705849171649 ], [ 121.062335372509295, 14.654533310715429 ], [ 121.062325930430561, 14.652984809802273 ], [ 121.063506190272903, 14.652994251881013 ], [ 121.064931944162453, 14.653022578117229 ], [ 121.065177438209659, 14.653022578117229 ], [ 121.065819499563887, 14.652663779125156 ], [ 121.06641435052444, 14.652116138558309 ], [ 121.067009201484979, 14.65180454995993 ], [ 121.067613494524281, 14.652267211818129 ], [ 121.068321650429681, 14.65248437962912 ], [ 121.06903924841383, 14.652522147944076 ], [ 121.070842685452931, 14.652522147944076 ], [ 121.071683030460676, 14.652522147944074 ], [ 121.071654704224457, 14.653929017676147 ], [ 121.072740543279409, 14.653938459754887 ], [ 121.07281607990933, 14.653589102841552 ], [ 121.072806637830581, 14.653570218684075 ], [ 121.072844406145535, 14.652559916259028 ], [ 121.074128513117216, 14.652550883337039 ], [ 121.074306771012758, 14.652565748718731 ], [ 121.074309820717971, 14.648368745653526 ], [ 121.074293354781773, 14.647693642269308 ] ] ] 
                }
            },
            {
                'type': 'Feature',
                "properties": { "type": 'philcoa' },
                "geometry": { 
                    "type": "MultiLineString", 
                    "coordinates": [ [ [ 121.059172085893451, 14.654717002243894 ], [ 121.062339088161877, 14.654797996683788 ], [ 121.062356277848849, 14.657685490873277 ], [ 121.063948373826548, 14.657675219286325 ], [ 121.064821458717546, 14.657572503416796 ], [ 121.06697849197765, 14.657572503416796 ], [ 121.068580859542308, 14.657551960242889 ], [ 121.068539773194487, 14.659421389068315 ], [ 121.070655720106785, 14.659431660655269 ], [ 121.072720309084318, 14.65945220382917 ], [ 121.07275112384518, 14.657572503416793 ], [ 121.074209689192486, 14.657582775003746 ], [ 121.074240503953348, 14.657356800090783 ], [ 121.074219960779445, 14.655189495243723 ], [ 121.074294958220293, 14.653600901318537 ], [ 121.074153271512515, 14.653592045899302 ], [ 121.07414477031007, 14.652598963764538 ], [ 121.073059271453758, 14.652580512157691 ], [ 121.072833296540793, 14.652559968983784 ], [ 121.072835760509747, 14.65227599916749 ], [ 121.072826592564851, 14.652159768612472 ], [ 121.072795763718702, 14.652087320824007 ], [ 121.071980754823713, 14.651368464897249 ], [ 121.07133364484568, 14.65097814459304 ], [ 121.071364459606528, 14.650526194767114 ], [ 121.071261743736997, 14.650413207310633 ], [ 121.072042384345409, 14.650413207310633 ], [ 121.072668951149538, 14.650628910636643 ], [ 121.073778282540459, 14.650587824288831 ], [ 121.073716653018735, 14.64901627148504 ], [ 121.073798825714363, 14.648286988811385 ], [ 121.072987370345075, 14.64826644563748 ], [ 121.072607321627828, 14.648256174050527 ], [ 121.072350531954001, 14.648143186594044 ], [ 121.071652064041203, 14.647711779942023 ], [ 121.071210385802232, 14.647434447094296 ], [ 121.070748164389357, 14.647300916463907 ], [ 121.068981451433459, 14.647167385833519 ], [ 121.068971179846514, 14.64855405007216 ], [ 121.068971179846514, 14.648985456724182 ], [ 121.068663032237922, 14.649735282571742 ], [ 121.068406242564109, 14.650505651593209 ], [ 121.068406242564109, 14.650916515071323 ], [ 121.068416514151053, 14.651183576332098 ], [ 121.068519230020584, 14.651656069331931 ], [ 121.068591131129253, 14.65197448852747 ], [ 121.068632217477074, 14.652344265657774 ], [ 121.068642489064018, 14.652518882635974 ], [ 121.068447328911915, 14.652498339462067 ], [ 121.067914167597294, 14.652364773686559 ], [ 121.067623183034286, 14.652234771762469 ], [ 121.06734391954366, 14.652072740186874 ], [ 121.067007703343961, 14.651802268138423 ], [ 121.06639352919926, 14.652133678939284 ], [ 121.06597187645626, 14.652467524701207 ], [ 121.065786987891116, 14.65265241326636 ], [ 121.065437753934717, 14.652888659766276 ], [ 121.065182040232585, 14.653029284247445 ], [ 121.065078248391359, 14.653022190396664 ], [ 121.06410244763083, 14.65301191880971 ], [ 121.063136918457261, 14.652981104048852 ], [ 121.062346006261905, 14.652960560874945 ], [ 121.062325463088001, 14.654614286374359 ], [ 121.062313640955253, 14.654964047168859 ], [ 121.06153343580084, 14.65496404716885 ], [ 121.0602366831247, 14.654943785408285 ], [ 121.059201923455078, 14.654913792374387 ] ] ] 
                }
            }
        ]
    };

    map.on('load', () => {
        map.addSource('line', {
            type: 'geojson',
            data: geojson_2
        });

        // add a line layer without line-dasharray defined to fill the gaps in the dashed line
        map.addLayer({
            type: 'line',
            source: 'line',
            id: 'line-background',
            paint: {
                'line-color': 'yellow',
                'line-width': 6,
                'line-opacity': 0.4
            },
            filter: ['==', 'type', 'ikot']
        });

        map.addLayer({
            type: 'line',
            source: 'line',
            id: 'line-background-2',
            paint: {
                'line-color': 'red',
                'line-width': 6,
                'line-opacity': 0.4
            },
            filter: ['==', 'type', 'katip']
        });

        map.addLayer({
            type: 'line',
            source: 'line',
            id: 'line-background-3',
            paint: {
                'line-color': 'green',
                'line-width': 6,
                'line-opacity': 0.4
            },
            filter: ['==', 'type', 'philcoa']
        });

        // add a line layer with line-dasharray set to the first value in dashArraySequence
        map.addLayer({
            type: 'line',
            source: 'line',
            id: 'line-dashed',
            paint: {
                'line-color': 'yellow',
                'line-width': 6,
                'line-dasharray': [0, 4, 3]
            },
            filter: ['==', 'type', 'ikot']
        });

        map.addLayer({
            type: 'line',
            source: 'line',
            id: 'line-dashed-2',
            paint: {
                'line-color': 'red',
                'line-width': 6,
                'line-dasharray': [0, 4, 3]
            },
            filter: ['==', 'type', 'katip']
        });

        map.addLayer({
            type: 'line',
            source: 'line',
            id: 'line-dashed-3',
            paint: {
                'line-color': 'green',
                'line-width': 6,
                'line-dasharray': [0, 4, 3]
            },
            filter: ['==', 'type', 'philcoa']
        });

    
        const layers = [
            'Ikot',
            'Katipunan',
            'Philcoa'
            ];
        const colors = [
            'yellow',
            'red',
            'green'
            ];

        const legend = document.getElementById('legend');

            layers.forEach((layer, i) => {
                const color = colors[i];
                const item = document.createElement('div');
                const key = document.createElement('span');
                key.className = 'legend-key';
                key.style.backgroundColor = color;

                const value = document.createElement('span');
                value.innerHTML = `${layer}`;
                item.appendChild(key);
                item.appendChild(value);
                legend.appendChild(item);
            });

        // technique based on https://jsfiddle.net/2mws8y3q/
        // an array of valid line-dasharray values, specifying the lengths of the alternating dashes and gaps that form the dash pattern
        const dashArraySequence = [
            [0, 4, 3],
            [0.5, 4, 2.5],
            [1, 4, 2],
            [1.5, 4, 1.5],
            [2, 4, 1],
            [2.5, 4, 0.5],
            [3, 4, 0],
            [0, 0.5, 3, 3.5],
            [0, 1, 3, 3],
            [0, 1.5, 3, 2.5],
            [0, 2, 3, 2],
            [0, 2.5, 3, 1.5],
            [0, 3, 3, 1],
            [0, 3.5, 3, 0.5]
        ];


        let step = 0;

        function animateDashArray(timestamp) {
            // Update line-dasharray using the next value in dashArraySequence. The
            // divisor in the expression `timestamp / 50` controls the animation speed.
            const newStep = parseInt(
                (timestamp / 50) % dashArraySequence.length
            );

            if (newStep !== step) {
                map.setPaintProperty(
                    'line-dashed',
                    'line-dasharray',
                    dashArraySequence[step]
                );
                map.setPaintProperty(
                    'line-dashed-2',
                    'line-dasharray',
                    dashArraySequence[step]
                );
                step = newStep;
                map.setPaintProperty(
                    'line-dashed-3',
                    'line-dasharray',
                    dashArraySequence[step]
                );
                step = newStep;
            }

            // Request the next frame of the animation.
            requestAnimationFrame(animateDashArray);
        }

        // start the animation
        animateDashArray(0);
    });

    

</script>

</body>
</html>
